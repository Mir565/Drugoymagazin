<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
  <meta name="author" content="GeeksLabs">
  <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
  <link rel="shortcut icon" href="img/favicon.png">
  <title>Smart Savdo</title>
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- bootstrap theme -->
  <link href="css/bootstrap-theme.css" rel="stylesheet">
  <!--external css-->
  <!-- font icon -->
  <link href="css/elegant-icons-style.css" rel="stylesheet" />
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <!-- Custom styles -->
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet" />

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 -->
  <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
      <script src="js/lte-ie7.js"></script>
    <![endif]-->

  <!-- =======================================================
      Theme Name: NiceAdmin
      Theme URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
      Author: BootstrapMade
      Author URL: https://bootstrapmade.com
    ======================================================= -->
</head>

<body>
  <!-- container section start -->
  <%- include('nav')%>

    <!--main content start-->
    <section id="main-content">
      <section class="wrapper">
        <div class="row">
          <div class="col-lg-12">
            <center><button type="button" class="btn btn-danger" id="xato"></button></center>
           <center><h2 style="color: black;" id="nameofcustomer"> </h2></center> 
        
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <section class="panel">
              <header class="panel-heading">
                  <center><h1 id="kun"></h1></center>
                  <center><h3 id="opshi"></h3></center>
                  <center><h3 id="skidka"></h3></center>
                  <center><h3 id="paysum"></h3></center>
              </header>
              <table class="table table-advance">
             

                <tbody id="mahsulot">
                 
                </tbody>
              </table>
            </section>
            <center>
              <button class="btn btn-primary" id="buttn"onclick="print1()">Print</button></center><br/>
          </div>
        </div>
        
              <div class="row" id="aaa">
                <div class="col-lg-12">
                 <center><h2 style="color: black;" id="nameofcustomer"></h2></center> 
                 <center><button class="btn btn-primary" onclick="minus()" >Tasdiqlash</button></center> 
              
                </div>
              </div>
              <div class="row">
                <div class="col-lg-12">
                  <section class="panel">
                    <header class="panel-heading">
                        <center><h1 id="kun"></h1></center>
                        <center><h3 id="opshi"></h3></center>
                    </header>
                    <table class="table table-advance">
                   
      
                      <tbody id="mahsulot1">
                       
                      </tbody>
                    </table>
                    <center><h3 id="all"></h3></center>
                    <center><h4 id="commentofMarket" style="display: none;color:black"></h4></center>
                  </section>
      <br/>
                </div>
        
            <div class="row">
              <div class="col-lg-12">
                <center><h2 style="color: black;" id="nameofcustomer">Qaytarib olingan mahsulotlar jadvali</h2></center> 
              
            
              </div>
            </div>
            <div class="row">
              <div class="col-lg-12">
                <section class="panel">
                  <header class="panel-heading">
                      <center><h1 id="kun"></h1></center>
                      <center><h3 id="opshi"></h3></center>
                    
                  </header>
                  <table class="table table-advance">
                 
    
                    <tbody id="mahsulot2">
                     
                    </tbody>
                  </table>
                </section>
    <br/>
              </div>
     
        <!-- page end-->
      </section>
    </section>
  </section>
  <style>

    @media print{
      #container,#buttn{
        display: none;
      }
    }
  </style>
  <style>
    @import url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css");

/* ---------------Animation---------------- */

.slit-in-vertical {
	-webkit-animation: slit-in-vertical 0.45s ease-out both;
	        animation: slit-in-vertical 0.45s ease-out both;
}

@-webkit-keyframes slit-in-vertical {
  0% {
    -webkit-transform: translateZ(-800px) rotateY(90deg);
            transform: translateZ(-800px) rotateY(90deg);
    opacity: 0;
  }
  54% {
    -webkit-transform: translateZ(-160px) rotateY(87deg);
            transform: translateZ(-160px) rotateY(87deg);
    opacity: 1;
  }
  100% {
    -webkit-transform: translateZ(0) rotateY(0);
            transform: translateZ(0) rotateY(0);
  }
}
@keyframes slit-in-vertical {
  0% {
    -webkit-transform: translateZ(-800px) rotateY(90deg);
            transform: translateZ(-800px) rotateY(90deg);
    opacity: 0;
  }
  54% {
    -webkit-transform: translateZ(-160px) rotateY(87deg);
            transform: translateZ(-160px) rotateY(87deg);
    opacity: 1;
  }
  100% {
    -webkit-transform: translateZ(0) rotateY(0);
            transform: translateZ(0) rotateY(0);
  }
}

/*---------------#region Alert--------------- */

#dialogoverlay{
  display: none;
  opacity: .8;
  position: fixed;
  top: 0px;
  left: 0px;
  background: #707070;
  width: 100%;
  z-index: 10;
}

#dialogbox{
  display: none;
  position: absolute;
  background: rgb(0, 47, 43);
  border-radius:7px; 
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.575);
  transition: 0.3s;
  width: 40%;
  z-index: 10;
  top:0;
  left: 0;
  right: 0;
  margin: auto;
}

#dialogbox:hover {
  box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.911);
}

.container {
  padding: 2px 16px;
}

.pure-material-button-contained {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
  border: none;
  border-radius: 4px;
  padding: 0 16px;
  min-width: 64px;
  height: 36px;
  vertical-align: middle;
  text-align: center;
  text-overflow: ellipsis;
  text-transform: uppercase;
  color: rgb(var(--pure-material-onprimary-rgb, 255, 255, 255));
  background-color: rgb(var(--pure-material-primary-rgb, 0, 77, 70));
  /* background-color: rgb(1, 47, 61) */
  box-shadow: 0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12);
  font-family: var(--pure-material-font, "Roboto", "Segoe UI", BlinkMacSystemFont, system-ui, -apple-system);
  font-size: 14px;
  font-weight: 500;
  line-height: 36px;
  overflow: hidden;
  outline: none;
  cursor: pointer;
  transition: box-shadow 0.2s;
}

.pure-material-button-contained::-moz-focus-inner {
  border: none;
}

/* ---------------Overlay--------------- */

.pure-material-button-contained::before {
  content: "";
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgb(var(--pure-material-onprimary-rgb, 255, 255, 255));
  opacity: 0;
  transition: opacity 0.2s;
}

/* Ripple */
.pure-material-button-contained::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  border-radius: 50%;
  padding: 50%;
  width: 32px; /* Safari */
  height: 32px; /* Safari */
  background-color: rgb(var(--pure-material-onprimary-rgb, 255, 255, 255));
  opacity: 0;
  transform: translate(-50%, -50%) scale(1);
  transition: opacity 1s, transform 0.5s;
}

/* Hover, Focus */
.pure-material-button-contained:hover,
.pure-material-button-contained:focus {
  box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.2), 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12);
}

.pure-material-button-contained:hover::before {
  opacity: 0.08;
}

.pure-material-button-contained:focus::before {
  opacity: 0.24;
}

.pure-material-button-contained:hover:focus::before {
  opacity: 0.3;
}

/* Active */
.pure-material-button-contained:active {
  box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 0.2), 0 8px 10px 1px rgba(0, 0, 0, 0.14), 0 3px 14px 2px rgba(0, 0, 0, 0.12);
}

.pure-material-button-contained:active::after {
  opacity: 0.32;
  transform: translate(-50%, -50%) scale(0);
  transition: transform 0s;
}

/* Disabled */
.pure-material-button-contained:disabled {
  color: rgba(var(--pure-material-onsurface-rgb, 0, 0, 0), 0.38);
  background-color: rgba(var(--pure-material-onsurface-rgb, 0, 0, 0), 0.12);
  box-shadow: none;
  cursor: initial;
}

.pure-material-button-contained:disabled::before {
  opacity: 0;
}

.pure-material-button-contained:disabled::after {
  opacity: 0;
}

#dialogbox > div{ 
  background:#FFF; 
  margin:8px; 
}

#dialogbox > div > #dialogboxhead{ 
  background: rgb(0, 77, 70); 
  font-size:19px; 
  padding:10px; 
  color:rgb(255, 255, 255); 
  font-family: Verdana, Geneva, Tahoma, sans-serif ;
}

#dialogbox > div > #dialogboxbody{ 
  background:rgb(0, 47, 43); 
  padding:20px; 
  color:#FFF; 
  font-family: Verdana, Geneva, Tahoma, sans-serif ;
}

#dialogbox > div > #dialogboxfoot{ 
  background: rgb(0, 47, 43); 
  padding:10px; 
  text-align:right; 
}
/*#endregion Alert*/
  </style>
  <center><h2 id="xarid"></h2></center>
  <!-- container section end -->
  <!-- javascripts -->
  <script src="js/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <!-- nicescroll -->
  <script src="js/jquery.scrollTo.min.js"></script>
  <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
  <!--custome script for all page-->
  <script src="js/scripts.js" ></script>
  <script>
    document.title=document.getElementsByClassName("page-header")[0].innerText;
    
   </script>
  <script>
    function CustomAlert(){
  this.alert = function(message,title){
    document.body.innerHTML = document.body.innerHTML + '<div id="dialogoverlay"></div><div id="dialogbox" class="slit-in-vertical"><div><div id="dialogboxhead"></div><div id="dialogboxbody"></div><div id="dialogboxfoot"></div></div></div>';

    let dialogoverlay = document.getElementById('dialogoverlay');
    let dialogbox = document.getElementById('dialogbox');
    
    let winH = window.innerHeight;
    dialogoverlay.style.height = winH+"px";
    
    dialogbox.style.top = "200px";

    dialogoverlay.style.display = "block";
    dialogbox.style.display = "block";
    
    document.getElementById('dialogboxhead').style.display = 'block';

    if(typeof title === 'undefined') {
      document.getElementById('dialogboxhead').style.display = 'none';
    } else {
      document.getElementById('dialogboxhead').innerHTML = '<i class="fa fa-exclamation-circle" aria-hidden="true"></i> '+ title;
    }
    document.getElementById('dialogboxbody').innerHTML = message;
    document.getElementById('dialogboxfoot').innerHTML = '<button class="pure-material-button-contained active" onclick="customAlert.ok()">OK</button>';
  }
  
  this.ok = function(){
    document.getElementById('dialogbox').style.display = "none";
    document.getElementById('dialogoverlay').style.display = "none";
  }
}

let customAlert = new CustomAlert();
    document.getElementById("xato").style.display="none";
  var x=0;
var jami=0;
var arrayName=[]
var arrayCount=[]
var arrayPrice=[]
var arraySell=[];
var arrayBazaCount=[];
var arrayBazaNarx=[];
document.getElementById('aaa').style.display="none";
function createTable1(){
  jami=0;
  arraySell=[]
  xs=`<tr> <th>#N</th>
       <th>Nomi</th>
      <th></th>
      <th></th>
       <th>Soni</th>
       <th>Narxi</th>
       <th>Jami</th>
      <th id="delete">O'chirish</th>
      </tr>`;
for (i=0;i<arrayPrice.length;i++){
  jami+=arrayPrice[i]*arrayCount[i];
  arraySell.push(arrayPrice[i]*arrayCount[i]);
 xs+=`<tr style="color:black;font-size:20px" ><td>${i+1}</td><td>${arrayName[i]}<td>        
          <td></td>
          <td onclick="cliked(${i})">${arrayCount[i]}</td>
          <td onclick="cliked1(${i})">${arrayPrice[i]}</td>
          <td>${arrayPrice[i]*arrayCount[i]}</td>
          <td><button class="btn btn-danger" id="delete1" onclick="addminus(s=${i})">O'chirish</button></td></tr>
          `
} 
document.getElementById('all').innerHTML=`Jami:${jami} so'm`;
document.getElementById('mahsulot1').innerHTML=xs;
}
    function print1(){
    window.print()
    }
    var z=[];
    var x=0;
    function createTable(Mahsulotlar){
     
      x++;
      s=`<tr> <th>Nomer</th>
  <th></th>
  <th></th>
  <th>Mahsulot Nomi</th><th>Mahsulot Miqdori</th><th>Mahsulot Narxi </th><th>Jami</th>  </tr>`;
      var table = document.getElementById('mahsulot')
      for (var i = 0; i < Mahsulotlar.CustomerClothes.length; i++) 
     {
     s+=` <tr id="tr${i}">  <td>${i+1}</td>
  <td></td>
  <td></td> <td><h4>${Mahsulotlar.CustomerClothes[i]}</h4></td><td onclick="man('${Mahsulotlar.CustomerClothes[i]}',${Mahsulotlar.CustomerBuy[i]},${Mahsulotlar.CustomerBuyNum[i]})">${Mahsulotlar.CustomerBuy[i]} </td><td>${Mahsulotlar.CustomerBuyNum[i]}</td><td>${Mahsulotlar.CustomerBuy[i]*Mahsulotlar.CustomerBuyNum[i]}</td>  </tr>`
      }
      table.innerHTML=s;
        }
    var arr=[]
    data=<%- JSON.stringify(data)%>;
    var data2=<%- JSON.stringify(data2)%>;
    // console.log(data2)
    sc=`<tr> <th>Nomer</th>
  <th></th>
  <th></th>
  <th>Mahsulot Nomi</th><th>Mahsulot Miqdori</th><th>Mahsulot Narxi </th><th>Jami</th>  </tr>`;
  var xx=0; 
  for (let i=0;i<data2.length;i++){
     for (let j=0;j<data2[i].numberofclothes.length;j++){
       xx++;
sc+=`<tr id="tr${xx}">  <td>${xx}</td>
  <td></td>
  <td></td> <td><h4>${data2[i].nameofclothes[j]}</h4></td><td >${data2[i].numberofclothes[j]} </td><td>${data2[i].numberofbuyprice[j]}</td><td>${parseFloat(data2[i].numberofbuyprice[j])*parseFloat(data2[i].numberofclothes[j])}</td>  </tr>`
     }
    }
    document.getElementById('mahsulot2').innerHTML=sc;
    // console.log(data)
    document.getElementById('nameofcustomer').innerHTML+=`Xaridor-${data.CustomerName}<br>Sotuvchi-${data.SellerName==undefined?"Admin":data.SellerName}`
    document.getElementById('kun').innerHTML+=`${data.CustomerDate}` 
    document.getElementById('opshi').innerHTML=`Jami ${data.CustomerAllBuy} so'm`
    document.getElementById('skidka').innerHTML=`Chegirma ${data.CustomerSkidka} %`;
    document.getElementById('paysum').innerHTML=`To'langan Summa ${data.CustomerAllBuy-(data.CustomerAllBuy/100)*data.CustomerSkidka} so'm`
        createTable(data);
    function searchBar(){
      var searchTextArr=[]
    var searchText=document.getElementById('searcher').value;
    for (q of arr){
      if (q.toLowerCase().indexOf(searchText.toLowerCase())==0){
        searchTextArr.push(q);
      }
    }
    createTable(searchTextArr)
    }
    function addminus(s){
arrayCount.splice(s,1);
arrayName.splice(s,1);
arrayPrice.splice(s,1);
createTable1();
}
var naqd,plastik,qarz,pulkochrish,kun,summa;
function money(){
   naqd=0;
   plastik=0;
   qarz=0;
   pulkochrish=0;
  summa=jami;
   naqd=prompt(`Naqd pul:${summa}`,summa);
   if (!naqd){
     naqd=0;
   }
  summa-=naqd;
  if (summa>0)
   plastik=prompt(`Plastik:${summa}`,summa);
   if(!plastik){
     plastik=0;
   }
 summa-=plastik;
 if (summa>0){ 
  qarz=prompt(`Qarz:${summa}`,summa);  
} 
if (!qarz){
  qarz=0;
}
  summa-=qarz;
 if (summa>0)
  pulkochrish=prompt(`Pul ko\'chirish:${summa}`,summa);
if (!pulkochrish){
  pulkochrish=0;
}
  summa-=pulkochrish;
  if (summa>0){
return 0;
}
}

function minus(){
  if (arrayCount.length==0){
    alert("Savdo amalga oshrilmadi!")
    return 0;
  }
  money();
  if (summa!=0){
    alert("Siz kiritishda xatolikka yo'l qo'ydingiz!")
    return 0;
  }
alert(`Naqd:${naqd},Plastik:${plastik},Qarz:${qarz},Pul Ko'chirish:${pulkochrish}`)
var r=confirm('Tasdiqlansinmi?')

if (r==true){
$.ajax({
  url:`/vazvrat?id=${data.CustomerDate}`,
  type:"POST",
  cache:false,
  contentType:'application/json',
  dataType:'json',
  data:JSON.stringify({nameofclothes:arrayName,numberofclothes:arrayCount,numberofbuyprice:arrayPrice,qarz:qarz,plastik:plastik,pulkochrish:pulkochrish,naqd:naqd,name:data.CustomerName,curiername:data.CurierName}),
  success:data=>{
    if (data.status==0){
     customAlert.alert("Kiritishda Xatolika Yo'l Qo'yildi. Iltimos Tekshiring!Kassada buncha pul mavjud emas yoki Xaridorni buncha miqdorda qarzi yo'q!")
    }
    else{
      location.reload();
    }
  }
})
}
}
    function man(nomi,soni,narxi){
      // console.log(1);
      newsoni=prompt("Qaytarib olinayotgan mahsulot miqdorini kiring!",soni)
      if (!parseFloat(newsoni)){
        alert("Son kiritishda xatolikka yo'l qo'ydingiz!")
        return 0;
      }
      newsoni=parseFloat(newsoni);
      if (parseFloat(newsoni)>parseFloat(soni)){
        alert("Xaridor buncha mahsulot sotib olmagan!")
        return 0;
      }
      newnarxi=prompt("Qaytarib olinayotgan mahsulot narxi",narxi)
      if (!parseFloat(newnarxi)){
        alert("Son kiritishda xatolikka yo'l qo'ydingiz!")
        return 0;
      }
      nolyokibir=0;
      for (let i=0;i<arrayName.length;i++){
        if (arrayName[i]==nomi){
nolyokibir=1;
if (arrayCount[i]+newsoni<=soni){
  arrayCount[i]+=newsoni;
  arrayPrice[i]=newnarxi;
}
else{
  alert("Xaridor buncha mahsulot sotib olmagan!")
        return 0;
}
}
      }
      if (!nolyokibir){
        arrayCount.push(newsoni);
      arrayName.push(nomi);
      arrayPrice.push(newnarxi)
      }
      document.getElementById('aaa').style.display="block"
      createTable1();
    }
     </script>
</body>
</html>