<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
  <meta name="author" content="GeeksLabs">
  <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">
  <link rel="shortcut icon" href="img/favicon.png">
  <title>Продажа</title>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-theme.css" rel="stylesheet">
  <link href="css/elegant-icons-style.css" rel="stylesheet" />
  <link href="css/font-awesome.min.css" rel="stylesheet" />
  <link href="css/style.css" rel="stylesheet">
  <link href="css/style-responsive.css" rel="stylesheet" />

</head>

<body>
  <%- include('nav')%>

    <section id="main-content">
      <section class="wrapper">
        <div class="row" id="sa">
          <div class="col-lg-12">
            <ol class="breadcrumb">
              <li><i class="fa fa-home"></i><a href="index.html">Домашняя страница
              </a></li>
              <li><i class="fa fa-table"></i>Продажи
              </li>
              <li><i class="fa fa-th-list"></i> Большой список
              </li>
            </ol>
          </div>
        </div>
        <center> <select  class="form-control" name="" id="customernames"></select>
        </center>
        <br>
        <div  id="sabzi">
          <table class="table table-striped table-advance table-hover" id="salom">
            <!-- <div class="clear"></div> -->
        </div>
        </center>
        <center><button style="margin-bottom: 5px;" class="btn btn-primary" onclick="minus()" id="tas">Подтверждение</button>
        </center>
        <center>
          <div class="form-check">
          
            <center>
              <b id="nameofMarket" style="display: none;color:black;font-size: 57px;font-family:'Arial Narrow', Arial, sans-serif;;"></b>
            </center>
            <br>
            <b id="nameofCustomer" style="display: none;font-size:30px;font-family:'Arial Narrow', Arial, sans-serif;color:black"></b>
            <b id="telofMarket" style="display: none;font-size:30px;font-family:'Arial Narrow', Arial, sans-serif;color:black"></b>
            <b id="timenow" style="display:none;font-size:30px;font-family:'Arial Narrow', Arial, sans-serif;color:black"></b>
    <b id="yulduz"  style="display: none;color:black;font-size: 40px;font-family:'Arial Narrow', Arial, sans-serif;" ></b>
    <br>
    
          </div>
        </center>
        <tbody id="mahsulot1">
    
        </tbody>
        </table>
        <b id="yulduz1" style="display: none;color:black;font-size: 40px;font-family:'Arial Narrow', Arial, sans-serif;" ></b>
        <center>
          <b style="font-size: 30px;font-family:'Arial Narrow', Arial, sans-serif;" id="all"></b>
        </center>
        <center>
          <b style="font-size: 45px;font-family:'Arial Narrow', Arial, sans-serif;" id="skidkani"></b>
        </center>
        <center>
          <b style="font-size: 45px;font-family:'Arial Narrow', Arial, sans-serif;" id="puli"></b>
        </center>
        <b id="yulduz2"  style="display: none;color:black;font-size: 40px;font-family:'Arial Narrow', Arial, sans-serif;" ></b>
        <center>
          <b style="font-size: 25px;font-family:'Arial Narrow', Arial, sans-serif;" id="commentofMarket" style="display: none;color:black"></b>
        </center>
         </div>
        <center>

        

          <h3 id="debtorofdebt"></h3>

       
          <datalist id="customernames">

          </datalist>


          <h3 style="color: black;" id="tovarsoni"> </h3>
          <h3 style="color: black;" id="tovar"></h3>
          <h3 style="color: black;" id="sotilishi"></h3>
          <h3 style="color: black;" id="foyda"></h3>
        </center>
        <select name="" style="color: white;background-color:#688a7e" id="pagenation" onchange="page(this.value)"
          onclick="page(this.value)"></select>
        <br>
        <br>
       
        <section id="kill">
          <div class="row">
            <div class="col-lg-12">
              <section class="panel">
                <div class="form-check form-switch">
                </div>

                <table class="table table-advance">
                  <input class="form-control" placeholder="Qidiruv" id="searcher" tabindex="0" onkeyup="searchBar(event)"
                    type="text">
                    <br>
                    <input class="form-control" placeholder="Qidiruv" id="searcher1" tabindex="0" onkeyup="searchBar1()"
                    type="text">


                  <tbody id="mahsulot">

                  </tbody>
                </table>
              </section>
        </section>
        </div>
        </div>

      </section>
    </section>

    <style>
    </style>
    <!--main content end-->
    </section>

    <style>
      @media print {
        body {
          margin: 0;
          padding: 0;
        }

        #customername,
        #pagenation,
        #delete,
        #delete1,
        section,
        .row,
        #flexCheckIndeterminate,
        #saqlash,
        #tas,
        #mahsulot,
        aside,
        #sa,
        header,
        #stat1,
        #stat,
        #searcher,
        #flexSwitchCheckChecked,
        #kamqolgan {
          display: none;
        }

        br {
          display: none;
        }

      }
    </style>
    <center>
      <h2 id="xarid"></h2>
    </center>
    <!-- container section end -->
    <!-- javascripts -->
 
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <!-- nicescroll -->
    <script src="js/jquery.scrollTo.min.js"></script>
    <script src="js/jquery.nicescroll.js" type="text/javascript"></script>
    <!--custome script for all page-->
    <script src="js/scripts.js"></script>
    <script>
    document.getElementById("searcher").focus();
      window.onload = function() {
  var inputs = document.getElementsByTagName('input');
  for (var i = 0; i < inputs.length; i++) {
    if (inputs[i].type == 'text') {
      inputs[i].onchange = function() {
        this.value = this.value.replace(/^\s+/, '').replace(/\s+$/, '');
      };
    }
  }
}
window.onbeforeunload = function () {
  // This will happen before leaving the page
  return 'Are you sure you want to leave?';
}
     
      var rol =<%- JSON.stringify(rol) %>
      var dict = {}
    var CustomerNames1 =<%- JSON.stringify(Customers) %>
    var CustomerNames =<%- JSON.stringify(data) %>
    var Curiernames =<%- JSON.stringify(datacurier) %>

    var telnumber;
     
      // console.log(CustomerNames1)
      
      var CustomerNamesSet = new Set();
      // console.log(CustomerNames1)
      for (q of CustomerNames1) {
        CustomerNamesSet.add(q.Email);
      }
      for (q of CustomerNamesSet) {
        if (q!="Admin123")
        document.getElementById('customernames').innerHTML += `<option value="${q}">${q}</option>`
      else
      document.getElementById('customernames').innerHTML += `<option value="">Выбирать
</option>`
      }
      function debtor(s) {
        // console.log(s);
        document.title = s;
        for (q of CustomerNames) {
          if (q.name === s) {
            debtjami = 0;
            telnumber = q.telnumber;
            for (v of q.debt) {
              debtjami += v;
            }
            for (i of q.paydebt) {
              debtjami -= i;
            }
            if (debtjami > 0)
              document.getElementById('debtorofdebt').innerHTML = `Задолженность выявлена:${debtjami} so'm`
            else {
              document.getElementById('debtorofdebt').innerHTML = `Долгов не выявлено
!`
            }
            return 0;
          }
          else {
            document.getElementById('debtorofdebt').innerHTML = `Долгов не выявлено
!`
          }
        }
      }
      function round(value, precision) {
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(value * multiplier) / multiplier;
}
   
      var kurs=<%- JSON.stringify(kurs) %>
      console.log(kurs)
      var Mahsulotlar;
      function createTable(Mahsulotlar, pagename) {
        begin = 0;
        end = Mahsulotlar.length;
        if (rol == "Admin") 
      {
          s = `<tr> <th >
        
        <i  class="fa fa-number" >
            </i>Посл.. чисел
</th>
            <th  >
                  <i  class="fa fa-shopping-cart">
                      </i> Наим... товара
</th> 
                      <th ><i class="fa fa-balance-scale">
                          </i> Остатка</th> 
                      <th  >
                        <i class="fa fa-money" >
                        </i>Цена получена
</th> 
                        <th >
                        <i class="fa fa-money" >

                        </i>Цена продажи
</th> <th><i class="icon_calendar" ></i>Коли.. на продажу
</th> 
                          <th id="stat"><i class="icon_cogs">
                            </i> Добавлять
</th>  <th id="stat">
  Рисунок
</th><th id="stat">
  Список</th> </tr>`;
          var table = document.getElementById('mahsulot')
          var f = 0;
          if (pagename=="search"){
        begin=0;
        if (100>Mahsulotlar.length){
          end=Mahsulotlar.length
        }
        else
        end=100;
        // console.log(Mahsulotlar)
      }
      else{
      begin=((pagename-1)*100);
      if (pagename*100<=Mahsulotlar.length){
        end=pagename*100;
      }
      else
      end=Mahsulotlar.length
    }
          if (pagename == "search") {
            for (var i = begin; i < end; i++) {
              if (dict[Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1]] == 1) {
                stylex = "#ff2d55";
              }
              else {
                stylex = "#ffffff";
              }
              var xname = Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1];
              var xcountnum = Mahsulotlar[i].countnum;
              var xprice =Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1] * kurs,3) : round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1],3);
              var xbuyprice = Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1] * kurs,3) :round (Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1],3)
              var xid = Mahsulotlar[i].id;
              var xcountof = Mahsulotlar[i].countof[Mahsulotlar[i].countof.length - 1];
              if (xcountnum <= xcountof) {
                s += `<tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i+1}</td><td>${xname}</td><td>${xcountnum}</td> <td >${xprice}</td><td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3}  name="${xname}" id="${xid}"   soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a target="_blank" class="btn btn-warning"   href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary"> Посмотреть список
</a></td></tr>`
              }
              else {
                // console.log(1);
                s += ` <tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i+1}</td><td>${xname}</td><td>${xcountnum}</td> <td >${xprice}</td><td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3} name="${xname}" id="${xid}"  soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a  target="_blank" class="btn btn-warning" href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary"> Посмотреть список
</a></td>  </tr>`
              }
              f++;
              if (f == 100) {
                break;
              }
            }
          }
          else {
            f = 0;
            for (var i = begin; i < end; i++) {
              if (dict[Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1]] == 1) {
                stylex = "#ff2d55";
              }
              else {
                stylex = "#ffffff";
              }
              var xname = Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1];
              var xcountnum = Mahsulotlar[i].countnum;
              var xprice =Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1] * kurs,3) : round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1],3);
              var xbuyprice = Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1] * kurs,3) :round (Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1],3)
              var xid = Mahsulotlar[i].id;
              var xcountof = Mahsulotlar[i].countof[Mahsulotlar[i].countof.length - 1];
              if (1==1) {
                if (xcountnum <= xcountof) {
                  s += `<tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i+1}</td><td>${xname}</td><td>${xcountnum}</td> <td >${xprice}</td><td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3} name="${xname}" id="${xid}"  soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a target="_blank" class="btn btn-warning" href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary">Посмотреть список
</a></td>  </tr>`
                }
                else {
                  s += `  <tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i+1}</td><td>${xname}</td><td>${xcountnum}</td> <td>${xprice}</td><td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3} name="${xname}" id="${xid}"  soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a target="_blank" class="btn btn-warning" href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary">Посмотреть список
</a></td>  </tr>`
                }
                f++;
              }
            }
          }
        }
        //for salesman;
        else{

          s = `<tr> <th >
        
        <i  class="fa fa-number" >
            </i>После.. чисел
</th>
            <th  >
                  <i  class="fa fa-shopping-cart">
                      </i> Наиме.. товара
</th> 
                      <th ><i class="fa fa-balance-scale">
                          </i>Остатка
                          </th>

                  <th>
                        <i class="fa fa-money" >


                        </i>Цена продажи
</th> <th><i class="icon_calendar" ></i>Кол.. на продажу
</th> 
                          <th id="stat"><i class="icon_cogs">
                            </i> Добавлять
</th>  <th id="stat">
  Рисунок
</th><th id="stat">
  Список
</th> </tr>`;
          var table = document.getElementById('mahsulot')
          var f = 0;
          if (pagename == "search") {
            for (var i = begin; i < end; i++) {
              if (dict[Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1]] == 1) {
                stylex = "#ff2d55";
              }
              else {
                stylex = "#ffffff";
              }
              var xname = Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1];
              var xcountnum = Mahsulotlar[i].countnum;
              var xprice =Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1] * kurs,3) : round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1],3);
              var xbuyprice = Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1] * kurs,3) :round (Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1],3)
              var xid = Mahsulotlar[i].id;
              var xcountof = Mahsulotlar[i].countof[Mahsulotlar[i].countof.length - 1];
              if (xcountnum <= xcountof) {
                s += `<tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i + 1}</td><td>${xname}</td><td>${xcountnum}</td><td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3} name="${xname}" id="${xid}"  soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a target="_blank" class="btn btn-warning" href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary">Посмотреть список
</a></td></tr>`
              }
              else {
                // console.log(1);
                s += ` <tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i + 1}</td><td>${xname}</td><td>${xcountnum}</td><td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3} name="${xname}" id="${xid}"  soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a  target="_blank" class="btn btn-warning" href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary">Посмотреть список</a></td>  </tr>`
              }
              f++;
              if (f == 100) {
                break;
              }
            }
          }
          else {
            f = 0;
            for (var i = begin; i < end; i++) {
              if (dict[Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1]] == 1) {
                stylex = "#ff2d55";
              }
              else {
                stylex = "#ffffff";
              }
              var xname = Mahsulotlar[i].name[Mahsulotlar[i].name.length - 1];
              var xcountnum = Mahsulotlar[i].countnum;
              var xprice =Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1] * kurs,3) : round(Mahsulotlar[i].price[Mahsulotlar[i].price.length - 1],3);
              var xbuyprice = Mahsulotlar[i].kurs[Mahsulotlar[i].kurs.length - 1] == "Dollar" ? round(Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1] * kurs,3) :round (Mahsulotlar[i].buyprice[Mahsulotlar[i].buyprice.length - 1],3)
              var xid = Mahsulotlar[i].id;
              var xcountof = Mahsulotlar[i].countof[Mahsulotlar[i].countof.length - 1];
              if (Mahsulotlar[i].bulim===pagename) {
                if (xcountnum <= xcountof) {
                  s += `<tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i + 1}</td><td>${xname}</td><td>${xcountnum}</td> <td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3} name="${xname}" id="${xid}"  soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a target="_blank" class="btn btn-warning" href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary">Посмотреть список
</a></td>  </tr>`
                }
                else {
                  s += `  <tr   style="font-size:20px;color:black;background-color:${stylex}" id="tr${f}"><td>${i + 1}</td><td>${xname}</td><td>${xcountnum}</td> <td><input  type="number" tabindex=${f * 3 + 2} name="${xid}" placeholder="${xbuyprice}" value="${xbuyprice}" style="font-size:20px;color:black" class="form-control"  /></td> 
                     <td><input type="number" tabindex=${f * 3 + 3} name="${xname}" id="${xid}"  soni="${xcountnum}" class="form-control" style="font-size:20px;color:black" /></td> <td id="stat1"> <div class="btn-group"> <button class="btn btn-success"  id="${xid}" name="${xcountnum}" tabindex=${f * 3 + 4}   onclick="add(this.id,this.name,${xprice})">
                      <i class="icon_plus_alt2"></i>Добавить</button> 
            </div> </td><td><a target="_blank" class="btn btn-warning" href="/rasm?id=${xname}">Рисунок</a></td><td><a href="#tas" class="btn btn-primary"> Посмотреть список
</a></td>  </tr>`
                }
                f++;
              }
            }
          }
        }

        table.innerHTML = s;
      }

      var bc = "false";
      var bp = "false";
      var bn = "false";


      function bol(bb) {
        if (bb == 1) {
          bn = "true";
          bc = "false";
          bp = "false";


        }
        if (bb == 2) {
          bn = "false";
          bc = "false";
          bp = "true";

        }
        if (bb == 3) {
          bn = "false";
          bc = "true";
          bp = "false";
        }
        $.ajax({
          url: `/api/getitem?count=${bc}&price=${bp}&name=${bn}`,
          type: 'GET', cache: false, dataType: 'json',
          contentType: 'application/json',
          success: function (data) {
            console.log("Loaded Data")
            Mahsulotlar = data.items;
            createTable(data.items, 1);
          },

        })
      }
      function checksee(){
    if (localStorage.getItem("seeprice")=="true") 
    localStorage.setItem("seeprice","false");
    else{
      localStorage.setItem("seeprice","true");
    }
    if (localStorage.getItem("seeprice")=="true"){
      document.getElementById("seepricex").innerHTML="Появляется полученная цена"
      document.getElementById("seepricex").className="btn btn-primary";}
      else{
        document.getElementById("seepricex").innerHTML=`<i class="fa fa-eye"></i> Просмотреть полученную цену
`
        document.getElementById("seepricex").className="btn btn-danger"  
      }
  createTable(Mahsulotlar,Mahsulotlar[0].bulim)
  }
  var allitems=<%- JSON.stringify(allitems) %>
  Mahsulotlar = allitems
          console.log("Loaded Data")
          for (i=0;i<Math.floor(Mahsulotlar.length/100)+1;i++){
           document.getElementById('pagenation').innerHTML+=`<option value="${i+1}" onclick="${page(i+1)}">${i+1}</option>`
          }
          createTable(Mahsulotlar, 1);
      function mana(s) {
        var r = confirm('Удалить?')
        if (r == true) {
          $.ajax({
            url: `/api/delete/${s}`,
            type: 'GET', cache: false, dataType: 'json',
            contentType: 'application/json',
            success: function (data) {

              if (data.status) {
                location.reload();
              }
            },
          })
        }
      }
      function searchBar(e) {
        console.log(1);
        var searchText = document.getElementById('searcher').value;
     
        if (searchText.length == 0) {
          createTable(Mahsulotlar, document.getElementById('pagenation').value)
        } else {
          var searchTextArr = []
          for (q of Mahsulotlar) {
            if (q.name[q.name.length - 1].toLowerCase().indexOf(searchText.toLowerCase()) > -1 || q.barkod===searchText.toLowerCase()) {
              searchTextArr.push(q);
            }
          }
          createTable(searchTextArr, "search")
        }
        if (e.keyCode===13){
          document.getElementById(searchTextArr[0].id).focus();
        }
      }
      
      function searchBar1() {
   console.log(1)
        var searchText1 = document.getElementById('searcher1').value;
 
        if (searchText1.length<1){
          return 0;
        }
        var searchText=document.getElementById("searcher").value;
        if (searchText.length == 0) {
          createTable(Mahsulotlar, document.getElementById('pagenation').value)
        } else {
          var searchTextArr = []
          for (q of Mahsulotlar) {
            if (q.name[q.name.length - 1].toLowerCase().indexOf(searchText.toLowerCase()) > -1 &&  q.price[q.price.length-1]===parseInt(searchText1)) {
              searchTextArr.push(q);
            }
          }
          createTable(searchTextArr, "search")
        }
      }
      

      function page(s) {
        document.getElementById('searcher').value = "";
        createTable(Mahsulotlar, s)
      }


      var jami = 0;
      var arrayName = []
      var arrayCount = []
      var arrayPrice = []
      var arraySell = [];
      var arrayBazaCount = [];
      var arrayBazaNarx = [];
      function createTable1() {
        jami = 0;
        arraySell = []
        xs = `<tr style="font-family:'Arial Narrow', Arial, sans-serif;font-size:23px"> <th>#N</th>
       <th>Название бренда</th>
      <th></th>
      <th></th>
       <th>Остаток</th>
       <th>Цена</th>
       <th>Все</th>
      <th id="delete">Удалить
</th>
      </tr>`;
        for (i = 0; i < arrayPrice.length; i++) {
          jami += arrayPrice[i] * arrayCount[i];
          arraySell.push(arrayPrice[i] * arrayCount[i]);
          xs +=`<tr style="color:black;font-size:20px;font-family:'Arial Narrow', Arial, sans-serif;" ><td>${i + 1}</td><td> <b style="color:black;font-size:25px;font-family:'Arial Narrow', Arial, sans-serif;">${arrayName[i]}</b><td>        
          <td></td>
          <td onclick="cliked(${i})"><b style="color:black;font-size:25px;font-family:'Arial Narrow', Arial, sans-serif;">${arrayCount[i]}</b></td>
          <td onclick="clikedone(${i})"><b style="color:black;font-size:25px;font-family:'Arial Narrow', Arial, sans-serif;">${arrayPrice[i]}</b> </td>
          <td><b style="color:black;font-size:25px;font-family:'Arial Narrow', Arial, sans-serif;">${arrayPrice[i] * arrayCount[i]}<b></td>
          <td><button class="btn btn-danger" id="delete1" onclick="addminus(s=${i})">O'chirish</button></td></tr>
          `
        }
        // document.getElementById('skidkani').innerHTML = `Chegirma:${skidka()}%`
        // document.getElementById("yulduz").innerHTML=`***************************************`;
        // document.getElementById("yulduz1").innerHTML=`***************************************`;
        // document.getElementById("yulduz2").innerHTML=`=======================================`;
        // document.getElementById('puli').innerHTML = `Summa:${jami - (jami * skidka() / 100)} so'm`
        document.getElementById('all').innerHTML = `Итого :${jami} so'm`;
        document.getElementById('mahsulot1').innerHTML = xs;
      }
      var naqd, plastik, qarz, pulkochrish, kun, summa, telnumber;
      function skidka() {
       return 0;
      }
      function kurier() {
          return "Ko'rsatilmagan"
        }
      function money() {
        naqd = 0;
        plastik = 0;
        qarz = 0;
        pulkochrish = 0;
        summa = jami - (jami * skidka() / 100);
        naqd = prompt(`Наличные:${summa}`, summa);
        summa -= naqd;
        if (summa > 0)
          plastik = prompt(`Пластик
:${summa}`, summa);
        summa -= plastik;
        if (summa > 0) {
          qarz = prompt(`Долг
:${summa}`, summa);
          if (qarz > 0) {
            sss = "";
            for (q of arrayName) {
              sss = sss + q + " ";
            }
            kun = prompt('За сколько дней он будет возвращен?', 10);
            if (!telnumber)
              telnumber = prompt("Номер телефона", "+998941234567")
            else {
              telnumber = prompt("Номер телефона", telnumber)
            }
          }
        }
        summa -= qarz;
        if (summa > 0)
          pulkochrish = prompt(`Перевод денег:${summa}`, summa);
        summa -= pulkochrish;
        if (summa > 0) {
          return 0;
        }
      }



      function cliked(i) {
        x = prompt("Остаток", arrayCount[i])
        if (!parseFloat(x)) {
          alert("Пожалуйста, введите номер!")
          return 0;
        }
        //  console.log(arrayBazaCount[i])
        if (parseFloat(arrayBazaCount[i]) < parseFloat(x)) {
          alert("В базе не так уж много товаров!")
          return 0;
        }
        if (parseFloat(x) < 0) {
          alert("Была сделана попытка ввести отрицательное число! Если это повторится, администратору будет отправлена ​​жалоба на продавца! \n Примечание: Попытка обмануть систему")
          return 0;
        }
        arrayCount[i] = x;
        createTable1();
      }
      function clikedone(i) {
        t = prompt("Цена", arrayPrice[i])
        if (!parseFloat(t)) {
          alert("Пожалуйста, введите номер!")
          return 0;
        }
        //  console.log(arrayBazaNarx[i])
        if (parseFloat(arrayBazaNarx[i]) >= parseFloat(t)) {
          alert("Вы пытаетесь продать в убыток! Проверьте это!")
          return 0;
        }
        arrayPrice[i] = t;
        createTable1();
      }
      var check = true;
      function add(s, soni, narxi) {
        document.getElementById("searcher").value="";
        document.getElementById('searcher1').value="";
        document.getElementById("searcher").focus();
        // console.log(narxi)
        // console.log(s);
        // console.log(soni)
        // console.log(parseFloat(document.getElementsByName(s)[0].value))
        if (parseFloat(document.getElementById(s).value) <= 0) {
          document.getElementById(s).value = ""
          alert("К сожалению, вы ввели отрицательное число! Пожалуйста, проверьте и попробуйте еще раз!")
          return 0;
        }
        if (parseFloat(narxi) >= (parseFloat(document.getElementsByName(s)[0].value))) {
          alert('Вы пытаетесь продать товар себе в убыток! Оцените!')
          return 0;
        }
        if (parseFloat(soni) < parseFloat(document.getElementById(s).value)) {
          alert("В базе не так уж много товаров!")
          document.getElementById(s).value = "";

        }
        if (document.getElementById(s).value.length > 0 && document.getElementById(s).name.length && document.getElementsByName(s)[0].value.length > 0) {
          fx = 0;
          for (let i = 0; i < arrayName.length; i++) {
            if (arrayName[i] === document.getElementById(s).name) {
              cx = parseFloat(document.getElementById(s).value);;
              if (arrayBazaCount[i] >= arrayCount[i] + cx) {
                arrayCount[i] = arrayCount[i] + cx;
                createTable1();
              }
              else {
                alert("Товаров в базе не так много! Произошла ошибка!")
              }
              fx = 1;
           
              document.getElementById(s).value = "";
            }
          }
          if (fx == 0) {
            dict[document.getElementById(s).name] = 1;
            arrayPrice.push(parseFloat(document.getElementsByName(s)[0].value));
            arrayCount.push(parseFloat(document.getElementById(s).value));
            arrayName.push(document.getElementById(s).name);
            arrayBazaCount.push(soni);
            arrayBazaNarx.push(narxi);
            createTable(Mahsulotlar, document.getElementById('pagenation').value)
            createTable1();
           
            document.getElementById(s).value = "";
           
          }
        }
 
      }
      $.ajax({
        url: `/api/getitem`,
        type: "GET",
        dataType: 'json',
        cache: false,
        contentType: 'application/json',
        success: data => {
          datalar = data
          // console.log(data)
          // console.log(data.customers)
          // document.getElementById('nameofMarket').innerHTML = `"${data.pasport.marketname}"`
          // document.getElementById('telofMarket').innerHTML = `Tel:${data.pasport.telnumber}`
          // document.getElementById('commentofMarket').innerHTML = `${data.pasport.comment}`
        }
      })
      function addminus(s) {
        dict[arrayName[s]] = 0;
        arrayCount.splice(s, 1);
        arrayName.splice(s, 1);
        arrayPrice.splice(s, 1);
        arrayBazaCount.splice(s, 1);
        arrayBazaNarx.splice(s, 1);
        createTable(Mahsulotlar, document.getElementById('pagenation').value);
        createTable1();
      }
      function CheckNull(t) {
        if (t === null) {
          return 0;
        }
        else {
          return t;
        }
      }
      function minus() {



        // document.getElementById('skidkani').innerHTML = `Chegirma:${skidka()}%`
        // document.getElementById('puli').innerHTML = `To'lanadigan Summa:${jami - (jami * skidka() / 100)} so'm`
        var customername = document.getElementById('customernames').value;
        
        if (customername.length == 0) {
          alert("Введите название магазина")
          return 0;
        }
        if (arrayCount.length == 0) {
          alert("Продажа не состоялась!")
          return 0;
        }
      //   document.getElementById('nameofCustomer').innerHTML = `Xaridor:${customername}`;
      //   document.getElementById('nameofMarket').style.display ="flex"
      //   document.getElementById('telofMarket').style.display = "flex"
      //   document.getElementById('commentofMarket').style.display = "flex"
      //   document.getElementById('nameofCustomer').style.display = "flex"
      //   document.getElementById('timenow').style.display = "flex"
      //   document.getElementById("yulduz").style.display="flex"
      //  document.getElementById("yulduz1").style.display="flex"
      //  document.getElementById("yulduz2").style.display="flex"
      //   document.getElementById("sabzi").style.paddingLeft="5%";
     
      //   document.getElementById("sabzi").style.paddingLeft = "16%";
        money();
        if (summa != 0) {
          alert("Вы сделали ошибку при входе!")
          return 0;
        }
        naqd = CheckNull(naqd);
        plastik = CheckNull(plastik)
        pulkochrish = CheckNull(pulkochrish)
        qarz = CheckNull(qarz);
        alert(`Наличные:${naqd}\n Пластик:${plastik}\n Перевод денег:${pulkochrish}\n Долг:${qarz}`)
        var r = confirm('Подтверждать?')
      //   document.getElementById('nameofMarket').style.display = "none"
      //   document.getElementById('telofMarket').style.display = "none"
      //   document.getElementById('commentofMarket').style.display = "none"
      //   document.getElementById('nameofCustomer').style.display = "none"
      //   document.getElementById('timenow').style.display = "none"
      //  document.getElementById("yulduz").style.display="none"
      //  document.getElementById("yulduz1").style.display="none"
      //  document.getElementById("yulduz2").style.display="none"
       
        if (r == true) {
          $.ajax({
            url: '/odebtplus?sotish=1',
            type: "POST",
            cache: false,
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify({ debt: qarz, name: customername, why: sss, day: kun, telnumber: telnumber }),
            success: data => {
            }
          })
          var curiername;

          $.ajax({
            url: '/api/minusitem',
            type: "POST",
            cache: false,
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify({ curiername: kurier(), summa: jami, naqd: naqd, plastik: plastik, pulkochrish: pulkochrish, qarz: qarz, minusName: arrayName, minusCount: arrayCount, payment: arraySell, CustomerName: customername, minusPayment: arrayPrice, check: true, skidka: skidka(), bazanarx: arrayBazaNarx }),
            success: data => {

            }
          })
          location.reload();
        }
      }
      today = new Date();
      var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
      document.getElementById('timenow').innerHTML += `Дата:${new Date().getDate()}.${new Date().getMonth() + 1}.${new Date().getFullYear()} ${time}`
    </script>
</body>
</html>